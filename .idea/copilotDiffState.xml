<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/rideshare/app/util/JwtUtils.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/rideshare/app/util/JwtUtils.java" />
              <option name="originalContent" value="package com.rideshare.app.util;&#10;&#10;import io.jsonwebtoken.Claims;&#10;import io.jsonwebtoken.Jwts;&#10;import io.jsonwebtoken.SignatureAlgorithm;&#10;import io.jsonwebtoken.security.Keys;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.stereotype.Component;&#10;&#10;import java.nio.charset.StandardCharsets;&#10;import java.security.Key;&#10;import java.util.Date;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import java.util.function.Function;&#10;&#10;@Component&#10;public class JwtUtils {&#10;&#10;    @Value(&quot;${jwt.secret}&quot;)&#10;    private String secret;&#10;&#10;    @Value(&quot;${jwt.expiration-ms}&quot;)&#10;    private long jwtExpirationMs;&#10;&#10;    private Key getSigningKey() {&#10;        return Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));&#10;    }&#10;    public String extractRole(String jwtToken) {&#10;        Claims claims = extractAllClaims(jwtToken);&#10;        return claims.get(&quot;role&quot;, String.class);&#10;    }&#10;    public String extractUserName(String jwtToken) {&#10;        return extractClaim(jwtToken, Claims::getSubject);&#10;    }&#10;    public Date extractExpiration(String jwtToken) {&#10;        return extractClaim(jwtToken, Claims::getExpiration);&#10;    }&#10;    public &lt;T&gt; T extractClaim(String jwtToken, Function&lt;Claims, T&gt; claimsResolver) {&#10;        Claims claims = extractAllClaims(jwtToken);&#10;        return claimsResolver.apply(claims);&#10;    }&#10;    private Claims extractAllClaims(String jwtToken) {&#10;        return Jwts.parserBuilder()&#10;                .setSigningKey(getSigningKey())&#10;                .build()&#10;                .parseClaimsJws(jwtToken)&#10;                .getBody();&#10;    }&#10;&#10;    private boolean isTokenExpired(String jwtToken) {&#10;        return extractExpiration(jwtToken).before(new Date());&#10;    }&#10;&#10;    public String generateToken(String username, String role) {&#10;        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();&#10;        claims.put(&quot;role&quot;, role);&#10;        Date now = new Date();&#10;        Date expiry = new Date(now.getTime() + jwtExpirationMs);&#10;        return Jwts.builder()&#10;                .setClaims(claims)&#10;                .setSubject(username)&#10;                .setIssuedAt(now)&#10;                .setExpiration(expiry)&#10;                .signWith(getSigningKey(), SignatureAlgorithm.HS256)&#10;                .compact();&#10;    }&#10;    public boolean validateToken(String jwtToken, String username) {&#10;        final String usernameFromToken = extractUserName(jwtToken);&#10;        return usernameFromToken.equals(username) &amp;&amp; !isTokenExpired(jwtToken);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.rideshare.app.util;&#10;&#10;import io.jsonwebtoken.Claims;&#10;import io.jsonwebtoken.Jwts;&#10;import io.jsonwebtoken.SignatureAlgorithm;&#10;import io.jsonwebtoken.security.Keys;&#10;import org.springframework.beans.factory.annotation.Value;&#10;import org.springframework.stereotype.Component;&#10;&#10;import java.nio.charset.StandardCharsets;&#10;import java.security.Key;&#10;import java.util.Date;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import java.util.function.Function;&#10;&#10;@Component&#10;public class JwtUtils {&#10;&#10;    @Value(&quot;${jwt.secret}&quot;)&#10;    private String secret;&#10;&#10;    @Value(&quot;${jwt.expiration-ms}&quot;)&#10;    private long jwtExpirationMs;&#10;&#10;    private Key getSigningKey() {&#10;        return Keys.hmacShaKeyFor(secret.getBytes(StandardCharsets.UTF_8));&#10;    }&#10;&#10;    public String extractRole(String jwtToken) {&#10;        Claims claims = extractAllClaims(jwtToken);&#10;        return claims.get(&quot;role&quot;, String.class);&#10;    }&#10;&#10;    public String extractUserName(String jwtToken) {&#10;        return extractClaim(jwtToken, Claims::getSubject);&#10;    }&#10;&#10;    public Date extractExpiration(String jwtToken) {&#10;        return extractClaim(jwtToken, Claims::getExpiration);&#10;    }&#10;&#10;    public &lt;T&gt; T extractClaim(String jwtToken, Function&lt;Claims, T&gt; claimsResolver) {&#10;        Claims claims = extractAllClaims(jwtToken);&#10;        return claimsResolver.apply(claims);&#10;    }&#10;&#10;    private Claims extractAllClaims(String jwtToken) {&#10;        // Updated for jjwt 0.12.x: use parser() instead of parserBuilder()&#10;        return Jwts.parser()&#10;                .setSigningKey(getSigningKey())&#10;                .build()&#10;                .parseSignedClaims(jwtToken)&#10;                .getPayload();&#10;    }&#10;&#10;    private boolean isTokenExpired(String jwtToken) {&#10;        return extractExpiration(jwtToken).before(new Date());&#10;    }&#10;&#10;    public String generateToken(String username, String role) {&#10;        Map&lt;String, Object&gt; claims = new HashMap&lt;&gt;();&#10;        claims.put(&quot;role&quot;, role);&#10;        Date now = new Date();&#10;        Date expiry = new Date(now.getTime() + jwtExpirationMs);&#10;        return Jwts.builder()&#10;                .claims(claims)&#10;                .subject(username)&#10;                .issuedAt(now)&#10;                .expiration(expiry)&#10;                .signWith(getSigningKey(), SignatureAlgorithm.HS256)&#10;                .compact();&#10;    }&#10;&#10;    public boolean validateToken(String jwtToken, String username) {&#10;        final String usernameFromToken = extractUserName(jwtToken);&#10;        return usernameFromToken.equals(username) &amp;&amp; !isTokenExpired(jwtToken);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>